#! https://zhuanlan.zhihu.com/p/468896455
# 跨平臺中國象棋版（一）初始化項目

最近閒來無聊，經常在B站上看看象棋，想做一個象棋軟件回味一下，順便回顧下之前學的技術，遂考慮自己做箇中國象棋玩玩。

Electron（最初名為Atom Shell[3]）是GitHub開發的一個開源框架。它允許使用Node.js（作為後端）和Chromium（作為前端）完成桌面GUI應用程序的開發。Electron現已被多個開源Web應用程序用於前端與後端的開發，著名項目包括GitHub的Atom和微軟的Visual Studio Code。

總的來說跨平臺的UI的解決方案很多種，Electron只是其中一種，不過這次就就選它吧。

## 腳手架

工欲善其事必先利其器，選擇一個腳手架能幫我們很快的搭建一個靠譜的項目。

看了總體來說electron-forge是個比較好的腳手架工具，就選它吧，官方地址[Getting Started - Electron Forge](https://www.electronforge.io/)。

Electron+React+TypeScript+Webpack 的環境，其實官方推薦的electron-forge腳手架工具本身就提供了這樣的環境搭建樣板，搭建方式如下：

### 安裝 electron-forge 腳手架

``` bash
npm install -g @electron-forge/cli
```

### 使用 create-electron-app 創建 typescript+webpack 的模板代碼

``` bash
npx create-electron-app electorn-chinese-chess --template=typescript-webpack
```

## 添加依賴

因為我們需要使用React來繪製頁面，所以需要添加React依賴。


### 安裝 React

``` bash
npm install --save react react-dom react-konva
npm install --save-dev @types/react @types/react-dom
```

### 測試

在 `src` 子文件夾下新建 `app.tsx` 文件，輸入：
```
import * as React from 'react';
import * as ReactDOM from 'react-dom';

function render() {
  ReactDOM.render(<h2>中國象棋</h2>, document.body);
}

render();
```

打開 `src/renderer.ts` 文件， 然後在最後添加下面一行：

``` typescipt
import "./app"
```

如果上面這行代碼提示找不到 ./app 模塊，注意查看 tsconfig.json 文件中的 compilerOptions 中是否有以下這一行：

```
"baseUrl": "src",
```

執行：

``` bash
npm run start
```

## 簡單優化

目前項目已經基本搭建成功，不過有幾個地方需要優化。

### 拆分main進程和renderer進程相關代碼

大家都知道，Electron分為`main`進程和`renderer`進程，個人偏好將他們分在不同的文件夾。

在`src` 下創建兩個文件夾`main` 以及 `renderer`

將`index.ts` 放入`main`文件夾下

將`renderer.ts` `index.html` `index.css` `app.tsx` 放入`renderer`文件夾下

分別修改`webpack.main.config` 以及 `package.json` 中的entry.

### 拆分forge配置

force配置由於後期涉及打包，可能會比較複雜，需將其從`package.json` 中拆出來。

新建`forge.config.js`文件。
將forge相關配置移除至`forge.config.js`文件

``` javascript
module.exports = {
    "packagerConfig": {
    },
    "makers": [
        {
            "name": "@electron-forge/maker-squirrel",
            "config": {
                "name": "electorn_chinese_chess"
            }
        },
        {
            "name": "@electron-forge/maker-zip",
            "platforms": [
                "darwin"
            ]
        },
        {
            "name": "@electron-forge/maker-deb",
            "config": {}
        },
        {
            "name": "@electron-forge/maker-rpm",
            "config": {}
        }
    ],
    "plugins": [
        [
            "@electron-forge/plugin-webpack",
            {
                "mainConfig": "./webpack.main.config.js",
                "renderer": {
                    "config": "./webpack.renderer.config.js",
                    "entryPoints": [
                        {
                            "html": "./src/renderer/index.html",
                            "js": "./src/renderer/renderer.ts",
                            "name": "main_window"
                        }
                    ]
                }
            }
        ]
    ]
}
```

### 添加應用圖標並修改應用名稱
在項目文件夾下新建`assets`文件夾，並在`assets/img`目錄下添加一枚圖標`chess.ico`

修改`forge.config.js`文件

``` javascript
module.exports = {
    "packagerConfig": {
        "name": "中國象棋",
        "icon": "./assets/img/chess.ico"
    },
```

修改`index.html`文件

``` html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>中國象棋</title>

  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
```

## 效果

![Image](https://pic4.zhimg.com/80/v2-4ccb3bb1ca4b9e6210148bb2693950c1.png)


本章源代碼 https://github.com/imbatony/electorn-chinese-chess
tag: 0.0.1